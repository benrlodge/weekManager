!function(e,t){"object"==typeof exports&&"function"==typeof require?module.exports=t(require("backbone")):"function"==typeof define&&define.amd?define(["backbone"],function(r){return t(r||e.Backbone)}):t(Backbone)}(this,function(e){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function r(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function o(e,t){for(var r=e.length;r--;)if(e[r]===t)return!0;return!1}function i(e,t){for(var r in t)e[r]=t[r];return e}return e.LocalStorage=window.Store=function(e,t){if(!this.localStorage)throw"Backbone.localStorage: Environment does not support localStorage.";this.name=e,this.serializer=t||{serialize:function(e){return _.isObject(e)?JSON.stringify(e):e},deserialize:function(e){return e&&JSON.parse(e)}};var r=this.localStorage().getItem(this.name);this.records=r&&r.split(",")||[]},i(e.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(e){return e.id||(e.id=r(),e.set(e.idAttribute,e.id)),this.localStorage().setItem(this.name+"-"+e.id,this.serializer.serialize(e)),this.records.push(e.id.toString()),this.save(),this.find(e)!==!1},update:function(e){this.localStorage().setItem(this.name+"-"+e.id,this.serializer.serialize(e));var t=e.id.toString();return o(this.records,t)||(this.records.push(t),this.save()),this.find(e)!==!1},find:function(e){return this.serializer.deserialize(this.localStorage().getItem(this.name+"-"+e.id))},findAll:function(){for(var e,t,r=[],o=0;o<this.records.length;o++)e=this.records[o],t=this.serializer.deserialize(this.localStorage().getItem(this.name+"-"+e)),null!=t&&r.push(t);return r},destroy:function(e){this.localStorage().removeItem(this.name+"-"+e.id);for(var t=e.id.toString(),r=0;r<this.records.length;r++)this.records[r]===t&&this.records.splice(r,1);return this.save(),e},localStorage:function(){return localStorage},_clear:function(){var e=this.localStorage(),t=new RegExp("^"+this.name+"-");e.removeItem(this.name);for(var r in e)t.test(r)&&e.removeItem(r);this.records.length=0},_storageSize:function(){return this.localStorage().length}}),e.LocalStorage.sync=window.Store.sync=e.localSync=function(t,r,o){var i,n,s=r.localStorage||r.collection.localStorage,a=e.$?e.$.Deferred&&e.$.Deferred():e.Deferred&&e.Deferred();try{switch(t){case"read":i=void 0!=r.id?s.find(r):s.findAll();break;case"create":i=s.create(r);break;case"update":i=s.update(r);break;case"delete":i=s.destroy(r)}}catch(c){n=22===c.code&&0===s._storageSize()?"Private browsing is unsupported":c.message}return i?(o&&o.success&&("0.9.10"===e.VERSION?o.success(r,i,o):o.success(i)),a&&a.resolve(i)):(n=n?n:"Record Not Found",o&&o.error&&("0.9.10"===e.VERSION?o.error(r,n,o):o.error(n)),a&&a.reject(n)),o&&o.complete&&o.complete(i),a&&a.promise()},e.ajaxSync=e.sync,e.getSyncMethod=function(t){return t.localStorage||t.collection&&t.collection.localStorage?e.localSync:e.ajaxSync},e.sync=function(t,r,o){return e.getSyncMethod(r).apply(this,[t,r,o])},e.LocalStorage});