(function(){var t,e,r,o={}.hasOwnProperty,n=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};e=!0,r=function(t){return e?console.log(t):void 0},t=function(t,e){return setTimeout(e,t)},$(function(){var e,o,s,i,a,c,u,p,l,h,d;return o={enter:13,esc:27},e={Mon:".mon",mon:".mon",monday:".mon",Tue:"tue",tue:".tue",Wed:".wed",wed:".wed",Thur:".thur",thur:".thur",Fri:".fri",fri:".fri",today:".today",td:".today",tomorrow:".tomorrow",tom:".tomorrow",od:".onDeck",onDeck:".onDeck",ondeck:".onDeck",backburner:".backburner",bb:".backburner"},s=function(t){function e(){return l=e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.defaults={target:".backBurner",detail:"empty",complete:!1},e.prototype.initialize=function(){return this.on("remove",this.destroy)},e}(Backbone.Model),c=new s,i=function(t){function e(){return h=e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.url="/",e.prototype.model=s,e.prototype.localStorage=new Store("backbone-tasks"),e.prototype.removeTask=function(t,e){return this.remove(t,e)},e}(Backbone.Collection),u=new i,a=function(s){function a(){return d=a.__super__.constructor.apply(this,arguments)}return n(a,s),a.prototype.el=$("body"),a.prototype.clickStatus=!1,a.prototype.lastDeletedTask="",a.prototype.taskInputWrapper=".newTask",a.prototype.taskInput="#newTaskInput",a.prototype.onDeck=".onDeck",a.prototype.onDeckList=".onDeck ul",a.prototype.today="",a.prototype.initialize=function(){return this.collection.on("add",this.render,this),this.collection.on("remove",this.render,this),this.fetchStoredCollections(),this.virginCheck(),this.sortablize()},a.prototype.events=function(){return{keypress:"searchKeyPress",keyup:"searchKeyUp","click .delete":"deleteTask","click a[data-action=undo]":"undoTask"}},a.prototype.template_week=Handlebars.compile($("#template_week").html()),a.prototype.template_sidebar=Handlebars.compile($("#template_sidebar").html()),a.prototype.render=function(){var t,e,r,o,n,s,a,c,u,p,l,h,d,k;return a=this.collection.where({target:".onDeck"}),t=this.collection.where({target:".backburner"}),n=this.collection.where({target:".mon"}),l=this.collection.where({target:".tue"}),d=this.collection.where({target:".wed"}),u=this.collection.where({target:".thur"}),r=this.collection.where({target:".fri"}),c=new i(a),e=new i(t),s=new i(n),h=new i(l),k=new i(d),p=new i(u),o=new i(r),$("#sidebar").html(this.template_sidebar({onDeckTasks:c.toJSON(),backBurnerTasks:e.toJSON()})),$(".week").html(this.template_week({monTasks:s.toJSON(),tueTasks:h.toJSON(),wedTasks:k.toJSON(),thurTasks:p.toJSON(),friTasks:o.toJSON()})),this.sortablize()},a.prototype.deleteTask=function(t){var e,r;return e=$(t.currentTarget),r=$(e).data("id"),this.undoShow(r),this.lastDeletedTask=this.collection.get(r),u.removeTask(r)},a.prototype.undoTask=function(){return u.create(this.lastDeletedTask),this.messageClear()},a.prototype.addTask=function(t){var e,r,o,n=this;return r=t.directive,e=t.detail,o=u.create({target:t.directive,detail:t.detail},{success:function(){return n.render()}})},a.prototype.fetchStoredCollections=function(){var t,e=this;return t=this.collection.fetch(),t.done(function(){_.each(e.collection.models,function(){},e)})},a.prototype.messageClear=function(){return $(".messages").empty()},a.prototype.messageUpdate=function(e){var r,o=this;return r="<a href='#' data-id='"+e.id+"' data-action='"+e.action+"'>"+e.message+"</a>",$(".messages").empty().append(r).addClass("show"),t(5e3,function(){return o.messageClear()})},a.prototype.undoShow=function(t){var e;return e={id:t,message:"Undo",action:"undo"},this.messageUpdate(e)},a.prototype.sortablize=function(){var t=this;return $(".sortable").sortable({connectWith:".sortable"}),$(".sortable").droppable({drop:function(){return t.updateOrder()}})},a.prototype.updateOrder=function(){return r("update the order")},a.prototype.searchHide=function(){return this.searchStatus=!1,$(this.taskInputWrapper).hide(),$(this.taskInput).val(""),this.clickStatus=!1},a.prototype.searchShow=function(){return this.searchStatus=!0,$(this.taskInputWrapper).show(),$(this.taskInput).focus(),this.clickStatus=!0},a.prototype.searchKeyPress=function(t){return t.keyCode===o.enter?this.searchComplete():this.searchShow()},a.prototype.searchKeyUp=function(t){return t.keyCode===o.esc&&this.searchStatus?this.searchHide():void 0},a.prototype.searchComplete=function(){var t;return c=$(this.taskInput).val().trim(),t=this.searchDirectives(c),this.addTask(t),this.searchHide()},a.prototype.searchDirectives=function(t){var r,o,n,s,i,a,c;o=t,i=t.split(":"),s=i[0],n=i[1],c=0;for(r in e)if(a=e[r],r===s)return c++,{directive:a,detail:n};return 0===c?{directive:".backburner",detail:t}:void 0},a.prototype.virginCheck=function(){return 0===this.collection.size()?(u.create({target:".mon",detail:"I am a task for Monday!"}),this.render()):void 0},a}(Backbone.View),p=new a({collection:u})})}).call(this);